<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€šå‹¤è·¯çº¿è§„åˆ’åŠ©æ‰‹</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <!-- é«˜å¾·åœ°å›¾ JS API -->
    <script src="https://webapi.amap.com/maps?v=2.0&key=a8a69c74031c9c30ae768bf1bd5e37ad&plugin=AMap.Driving,AMap.Transfer,AMap.Walking"></script>
    <style>
        :root {
            --primary: #0ea5e9;
            --primary-dark: #0284c7;
            --primary-light: #38bdf8;
            --secondary: #f97316;
            --accent: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-hover: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #475569;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(14, 165, 233, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(249, 115, 22, 0.1) 0%, transparent 60%),
                var(--bg-dark);
        }

        .floating-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            pointer-events: none;
        }

        .shape {
            position: absolute;
            border-radius: 50%;
            opacity: 0.1;
            animation: float 20s infinite ease-in-out;
        }

        .shape:nth-child(1) {
            width: 300px;
            height: 300px;
            background: var(--primary);
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .shape:nth-child(2) {
            width: 200px;
            height: 200px;
            background: var(--accent);
            top: 60%;
            right: 10%;
            animation-delay: -5s;
        }

        .shape:nth-child(3) {
            width: 150px;
            height: 150px;
            background: var(--secondary);
            bottom: 20%;
            left: 30%;
            animation-delay: -10s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(50px, -50px) rotate(90deg); }
            50% { transform: translate(0, -100px) rotate(180deg); }
            75% { transform: translate(-50px, -50px) rotate(270deg); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 50px;
            animation: slideDown 0.8s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: var(--gradient-3);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            box-shadow: 0 10px 40px rgba(79, 172, 254, 0.3);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .route-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .location-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: var(--bg-card);
            border-radius: 30px;
            border: 1px solid var(--border);
        }

        .location-badge .icon {
            font-size: 20px;
        }

        .arrow-icon {
            font-size: 24px;
            color: var(--primary);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        .deadline-badge {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            padding: 10px 25px;
            border-radius: 30px;
            font-weight: 500;
            box-shadow: 0 5px 20px rgba(239, 68, 68, 0.3);
        }

        /* Transport Buttons */
        .transport-section {
            margin-bottom: 40px;
            animation: fadeIn 0.8s ease-out 0.2s both;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 500;
            margin-bottom: 20px;
            color: var(--text-secondary);
        }

        .transport-buttons {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .transport-btn {
            flex: 1;
            min-width: 200px;
            padding: 25px 30px;
            border: 2px solid transparent;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 15px;
            font-family: inherit;
            font-size: 1.1rem;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .transport-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .transport-btn:hover::before {
            opacity: 1;
        }

        .transport-btn.taxi {
            background: var(--bg-card);
            color: var(--text-primary);
            border-color: var(--secondary);
        }

        .transport-btn.taxi::before {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.2), rgba(249, 115, 22, 0.05));
        }

        .transport-btn.taxi:hover, .transport-btn.taxi.active {
            background: linear-gradient(135deg, var(--secondary), #ea580c);
            box-shadow: 0 10px 40px rgba(249, 115, 22, 0.4);
            transform: translateY(-5px);
        }

        .transport-btn.metro {
            background: var(--bg-card);
            color: var(--text-primary);
            border-color: var(--primary);
        }

        .transport-btn.metro::before {
            background: linear-gradient(135deg, rgba(14, 165, 233, 0.2), rgba(14, 165, 233, 0.05));
        }

        .transport-btn.metro:hover, .transport-btn.metro.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            box-shadow: 0 10px 40px rgba(14, 165, 233, 0.4);
            transform: translateY(-5px);
        }

        .transport-btn.bus {
            background: var(--bg-card);
            color: var(--text-primary);
            border-color: var(--success);
        }

        .transport-btn.bus::before {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.05));
        }

        .transport-btn.bus:hover, .transport-btn.bus.active {
            background: linear-gradient(135deg, var(--success), #059669);
            box-shadow: 0 10px 40px rgba(16, 185, 129, 0.4);
            transform: translateY(-5px);
        }

        .transport-btn .icon {
            font-size: 32px;
        }

        .transport-btn .label {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .transport-btn .label span:last-child {
            font-size: 0.85rem;
            opacity: 0.8;
            font-weight: 400;
        }

        /* Routes Panel */
        .routes-panel {
            background: var(--bg-card);
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--border);
            display: none;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .routes-panel.active {
            display: block;
        }

        .routes-panel h3 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .route-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .route-btn {
            flex: 1;
            min-width: 280px;
            padding: 20px;
            background: var(--bg-dark);
            border: 2px solid var(--border);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            color: var(--text-primary);
            text-align: left;
        }

        .route-btn:hover {
            border-color: var(--primary);
            background: var(--bg-hover);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .route-btn.active {
            border-color: var(--primary);
            background: rgba(14, 165, 233, 0.1);
        }

        .route-btn .route-name {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .route-btn .route-stats {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .route-btn .route-stats span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Route Details */
        .route-details {
            background: var(--bg-card);
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--border);
            display: none;
            animation: slideUp 0.5s ease-out;
        }

        .route-details.active {
            display: block;
        }

        .details-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .details-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .details-summary {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        .summary-item {
            text-align: center;
            padding: 15px 25px;
            background: var(--bg-dark);
            border-radius: 16px;
            min-width: 120px;
        }

        .summary-item .value {
            font-size: 1.8rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            background: var(--gradient-3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .summary-item .label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 5px;
        }

        .summary-item.cost .value {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Map Container */
        .map-container {
            width: 100%;
            height: 450px;
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 25px;
            border: 2px solid var(--border);
            position: relative;
        }

        .map-container::before {
            content: 'ğŸ—ºï¸ åŠ è½½åœ°å›¾ä¸­...';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--text-muted);
            font-size: 1.2rem;
            z-index: 1;
        }

        #routeMap {
            width: 100%;
            height: 100%;
            position: relative;
            z-index: 2;
        }

        .map-legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding: 15px 20px;
            background: var(--bg-dark);
            border-radius: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .legend-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
        }

        .legend-dot.start {
            background: #22c55e;
        }

        .legend-dot.end {
            background: #ef4444;
        }

        .legend-line {
            width: 30px;
            height: 4px;
            border-radius: 2px;
        }

        .legend-line.driving {
            background: #f97316;
        }

        .legend-line.metro {
            background: #0ea5e9;
        }

        .legend-line.bus {
            background: #10b981;
        }

        .legend-line.walking {
            background: #94a3b8;
            background: repeating-linear-gradient(
                90deg,
                #94a3b8,
                #94a3b8 4px,
                transparent 4px,
                transparent 8px
            );
        }

        /* Route Timeline */
        .route-timeline {
            position: relative;
            padding-left: 40px;
        }

        .route-timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, var(--primary), var(--accent), var(--success));
            border-radius: 3px;
        }

        .timeline-item {
            position: relative;
            padding: 20px;
            background: var(--bg-dark);
            border-radius: 16px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .timeline-item:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -32px;
            top: 28px;
            width: 16px;
            height: 16px;
            background: var(--bg-card);
            border: 3px solid var(--primary);
            border-radius: 50%;
        }

        .timeline-item.walking::before {
            border-color: var(--text-secondary);
        }

        .timeline-item.transit::before {
            border-color: var(--primary);
        }

        .timeline-item.bus-transit::before {
            border-color: var(--success);
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .timeline-type {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }

        .timeline-type .icon {
            font-size: 24px;
        }

        .timeline-duration {
            font-family: 'JetBrains Mono', monospace;
            color: var(--primary-light);
            font-size: 0.95rem;
        }

        .timeline-content {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .timeline-stops {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .stop-tag {
            padding: 5px 12px;
            background: var(--bg-hover);
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .stop-tag.highlight {
            background: rgba(14, 165, 233, 0.2);
            border-color: var(--primary);
            color: var(--primary-light);
        }

        /* Time Checker Section */
        .time-checker {
            background: linear-gradient(135deg, var(--bg-card), rgba(139, 92, 246, 0.1));
            border-radius: 24px;
            padding: 35px;
            border: 2px solid var(--accent);
            margin-bottom: 30px;
            animation: fadeIn 0.8s ease-out 0.4s both;
        }

        .time-checker h2 {
            font-size: 1.4rem;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .time-checker h2 .icon {
            font-size: 28px;
        }

        .checker-content {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            align-items: flex-start;
        }

        .time-input-group {
            flex: 1;
            min-width: 250px;
        }

        .time-input-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .time-input {
            width: 100%;
            padding: 15px 20px;
            background: var(--bg-dark);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.2rem;
            transition: all 0.3s;
        }

        .time-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }

        .station-select-group {
            flex: 2;
            min-width: 300px;
            display: none;
        }

        .station-select-group.active {
            display: block;
            animation: fadeIn 0.4s ease-out;
        }

        .station-question {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: var(--warning);
        }

        .station-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .station-grid::-webkit-scrollbar {
            width: 6px;
        }

        .station-grid::-webkit-scrollbar-track {
            background: var(--bg-dark);
            border-radius: 3px;
        }

        .station-grid::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .station-btn {
            padding: 12px 15px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            font-size: 0.9rem;
            text-align: left;
        }

        .station-btn:hover {
            border-color: var(--accent);
            background: var(--bg-hover);
        }

        .station-btn.selected {
            border-color: var(--accent);
            background: rgba(139, 92, 246, 0.2);
        }

        .station-btn .line-tag {
            display: block;
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 3px;
        }

        /* Result Display */
        .result-display {
            margin-top: 25px;
            padding: 25px;
            border-radius: 16px;
            display: none;
            animation: slideUp 0.4s ease-out;
        }

        .result-display.active {
            display: block;
        }

        .result-display.safe {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.05));
            border: 2px solid var(--success);
        }

        .result-display.warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.05));
            border: 2px solid var(--warning);
        }

        .result-display.danger {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.05));
            border: 2px solid var(--danger);
        }

        .result-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .result-message {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .result-detail {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 30px;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        footer a {
            color: var(--primary);
            text-decoration: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .container {
                padding: 20px 15px;
            }

            .transport-btn {
                min-width: 100%;
            }

            .route-btn {
                min-width: 100%;
            }

            .checker-content {
                flex-direction: column;
            }

            .details-summary {
                justify-content: center;
            }

            .map-container {
                height: 350px;
            }
        }

        /* é«˜å¾·åœ°å›¾ä¿¡æ¯çª—å£æ ·å¼è¦†ç›– */
        .amap-info-content {
            padding: 10px 15px;
            font-family: 'Noto Sans SC', sans-serif;
        }

        .custom-marker {
            background: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">ğŸš€</div>
                <h1>é€šå‹¤è·¯çº¿è§„åˆ’åŠ©æ‰‹</h1>
            </div>
            <div class="route-info">
                <div class="location-badge">
                    <span class="icon">ğŸ </span>
                    <span>ä¸Šæµ·é©¬æˆåŸ</span>
                </div>
                <span class="arrow-icon">â”</span>
                <div class="location-badge">
                    <span class="icon">ğŸ¢</span>
                    <span>ä¸Šæµ·æ•°æ®äº¤æ˜“æ‰€</span>
                </div>
                <div class="deadline-badge">
                    â° é¡»åœ¨ 09:00 å‰åˆ°è¾¾
                </div>
            </div>
        </header>

        <section class="transport-section">
            <h2 class="section-title">é€‰æ‹©å‡ºè¡Œæ–¹å¼</h2>
            <div class="transport-buttons">
                <button class="transport-btn taxi" onclick="selectTransport('taxi')">
                    <span class="icon">ğŸš•</span>
                    <div class="label">
                        <span>æ‰“è½¦</span>
                        <span>çº¦32åˆ†é’Ÿ Â· Â¥60-80</span>
                    </div>
                </button>
                <button class="transport-btn metro" onclick="selectTransport('metro')">
                    <span class="icon">ğŸš‡</span>
                    <div class="label">
                        <span>åœ°é“</span>
                        <span>çº¦79åˆ†é’Ÿ Â· Â¥6</span>
                    </div>
                </button>
                <button class="transport-btn bus" onclick="selectTransport('bus')">
                    <span class="icon">ğŸšŒ</span>
                    <div class="label">
                        <span>å…¬äº¤è½¦</span>
                        <span>çº¦81-94åˆ†é’Ÿ Â· Â¥4-8</span>
                    </div>
                </button>
            </div>
        </section>

        <!-- æ‰“è½¦è·¯çº¿ -->
        <div id="taxi-routes" class="routes-panel">
            <h3>ğŸš• æ‰“è½¦è·¯çº¿æ–¹æ¡ˆ</h3>
            <div class="route-options">
                <button class="route-btn" onclick="selectRoute('taxi', 0)">
                    <div class="route-name">ğŸ›£ï¸ ä¸­ç¯è·¯çº¿</div>
                    <div class="route-stats">
                        <span>â±ï¸ çº¦32åˆ†é’Ÿ</span>
                        <span>ğŸ“ 26å…¬é‡Œ</span>
                        <span>ğŸ’° Â¥60-80</span>
                    </div>
                </button>
            </div>
        </div>

        <!-- åœ°é“è·¯çº¿ -->
        <div id="metro-routes" class="routes-panel">
            <h3>ğŸš‡ åœ°é“è·¯çº¿æ–¹æ¡ˆ</h3>
            <div class="route-options">
                <button class="route-btn" onclick="selectRoute('metro', 0)">
                    <div class="route-name">ğŸ”µ 1å·çº¿ â†’ 2å·çº¿ï¼ˆçº¯åœ°é“ï¼‰</div>
                    <div class="route-stats">
                        <span>â±ï¸ çº¦79åˆ†é’Ÿ</span>
                        <span>ğŸš¶ æ­¥è¡Œ2.4km</span>
                        <span>ğŸ’° Â¥6</span>
                    </div>
                </button>
                <button class="route-btn" onclick="selectRoute('metro', 1)">
                    <div class="route-name">ğŸ”µ 1å·çº¿ â†’ 2å·çº¿ + 1058è·¯</div>
                    <div class="route-stats">
                        <span>â±ï¸ çº¦81åˆ†é’Ÿ</span>
                        <span>ğŸš¶ æ­¥è¡Œ1.4km</span>
                        <span>ğŸ’° Â¥8</span>
                    </div>
                </button>
            </div>
        </div>

        <!-- å…¬äº¤è·¯çº¿ -->
        <div id="bus-routes" class="routes-panel">
            <h3>ğŸšŒ å…¬äº¤è·¯çº¿æ–¹æ¡ˆ</h3>
            <div class="route-options">
                <button class="route-btn" onclick="selectRoute('bus', 0)">
                    <div class="route-name">ğŸŸ¢ 46è·¯ â†’ 2å·çº¿ + 1058è·¯</div>
                    <div class="route-stats">
                        <span>â±ï¸ çº¦94åˆ†é’Ÿ</span>
                        <span>ğŸš¶ æ­¥è¡Œ1.4km</span>
                        <span>ğŸ’° Â¥10</span>
                    </div>
                </button>
                <button class="route-btn" onclick="selectRoute('bus', 1)">
                    <div class="route-name">ğŸŸ¢ 46è·¯ â†’ 451è·¯ â†’ 989è·¯</div>
                    <div class="route-stats">
                        <span>â±ï¸ çº¦124åˆ†é’Ÿ</span>
                        <span>ğŸš¶ æ­¥è¡Œ1.4km</span>
                        <span>ğŸ’° Â¥6</span>
                    </div>
                </button>
                <button class="route-btn" onclick="selectRoute('bus', 2)">
                    <div class="route-name">ğŸŸ¢ 95è·¯ â†’ 2å·çº¿</div>
                    <div class="route-stats">
                        <span>â±ï¸ çº¦97åˆ†é’Ÿ</span>
                        <span>ğŸš¶ æ­¥è¡Œ2.8km</span>
                        <span>ğŸ’° Â¥8</span>
                    </div>
                </button>
            </div>
        </div>

        <!-- è·¯çº¿è¯¦æƒ… -->
        <div id="route-details" class="route-details">
            <div class="details-header">
                <h3 class="details-title" id="details-title">è·¯çº¿è¯¦æƒ…</h3>
                <div class="details-summary" id="details-summary">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- åœ°å›¾å®¹å™¨ -->
            <div class="map-container">
                <div id="routeMap"></div>
            </div>
            
            <!-- åœ°å›¾å›¾ä¾‹ -->
            <div class="map-legend">
                <div class="legend-item">
                    <div class="legend-dot start"></div>
                    <span>èµ·ç‚¹</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot end"></div>
                    <span>ç»ˆç‚¹</span>
                </div>
                <div class="legend-item" id="legend-driving" style="display: none;">
                    <div class="legend-line driving"></div>
                    <span>é©¾è½¦è·¯çº¿</span>
                </div>
                <div class="legend-item" id="legend-metro" style="display: none;">
                    <div class="legend-line metro"></div>
                    <span>åœ°é“çº¿è·¯</span>
                </div>
                <div class="legend-item" id="legend-bus" style="display: none;">
                    <div class="legend-line bus"></div>
                    <span>å…¬äº¤çº¿è·¯</span>
                </div>
                <div class="legend-item" id="legend-walking" style="display: none;">
                    <div class="legend-line walking"></div>
                    <span>æ­¥è¡Œè·¯çº¿</span>
                </div>
            </div>
            
            <div class="route-timeline" id="route-timeline">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- æ—¶é—´æ£€æŸ¥å™¨ -->
        <section class="time-checker">
            <h2><span class="icon">â°</span> é€šå‹¤æ—¶é—´æ£€æŸ¥å™¨</h2>
            <div class="checker-content">
                <div class="time-input-group">
                    <label>é€‰æ‹©å½“å‰æ—¶é—´</label>
                    <input type="time" class="time-input" id="currentTime" onchange="onTimeSelect()">
                </div>
                <div class="station-select-group" id="stationSelectGroup">
                    <div class="station-question">ğŸ“ ä½ ç°åœ¨åˆ°å“ªå„¿äº†ï¼Ÿ</div>
                    <div class="station-grid" id="stationGrid">
                        <!-- åŠ¨æ€ç”Ÿæˆç«™ç‚¹ -->
                    </div>
                </div>
            </div>
            <div class="result-display" id="resultDisplay">
                <div class="result-icon" id="resultIcon"></div>
                <div class="result-message" id="resultMessage"></div>
                <div class="result-detail" id="resultDetail"></div>
            </div>
        </section>

        <footer>
            <p>æ•°æ®æ¥æºï¼š<a href="https://lbs.amap.com" target="_blank">é«˜å¾·åœ°å›¾å¼€æ”¾å¹³å°</a></p>
            <p>Â© 2025 é€šå‹¤è·¯çº¿è§„åˆ’åŠ©æ‰‹ | ç¥æ‚¨é€šå‹¤é¡ºåˆ©ï¼</p>
        </footer>
    </div>

    <script>
        // èµ·ç‚¹å’Œç»ˆç‚¹åæ ‡
        const originCoord = [121.451111, 31.277829]; // ä¸Šæµ·é©¬æˆåŸ
        const destCoord = [121.628845, 31.221087];   // ä¸Šæµ·æ•°æ®äº¤æ˜“æ‰€

        // åœ°å›¾å®ä¾‹
        let map = null;
        let currentPolylines = [];
        let currentMarkers = [];

        // åœ°é“ç«™ç‚¹åæ ‡æ•°æ®
        const stationCoords = {
            // 1å·çº¿ç«™ç‚¹
            'ä¸Šæµ·é©¬æˆåŸ': [121.452026, 31.279892],
            'å»¶é•¿è·¯': [121.455789, 31.268456],
            'ä¸­å±±åŒ—è·¯': [121.458123, 31.258789],
            'ä¸Šæµ·ç«è½¦ç«™': [121.460789, 31.249456],
            'æ±‰ä¸­è·¯': [121.464123, 31.241789],
            'æ–°é—¸è·¯': [121.468456, 31.237123],
            'äººæ°‘å¹¿åœº': [121.472656, 31.233160],
            // 2å·çº¿ç«™ç‚¹
            'å—äº¬ä¸œè·¯': [121.481234, 31.238567],
            'é™†å®¶å˜´': [121.499876, 31.240123],
            'æµ¦ä¸œå—è·¯(åŸä¸œæ˜Œè·¯)': [121.514567, 31.234890],
            'ä¸–çºªå¤§é“': [121.527123, 31.229456],
            'ä¸Šæµ·ç§‘æŠ€é¦†': [121.544678, 31.220123],
            'ä¸–çºªå…¬å›­': [121.556789, 31.214567],
            'é¾™é˜³è·¯': [121.567890, 31.207654],
            'å¼ æ±Ÿé«˜ç§‘': [121.590123, 31.203456],
            'é‡‘ç§‘è·¯': [121.605678, 31.208901],
            'å¹¿å…°è·¯': [121.621071, 31.211046],
            // 46è·¯å…¬äº¤ç«™ç‚¹
            'å…±å’Œæ–°è·¯å¤§å®è·¯': [121.452492, 31.276728],
            'å…±å’Œæ–°è·¯å»¶é•¿ä¸­è·¯': [121.454321, 31.267890],
            'é—¸åŒ—å…¬å›­': [121.456789, 31.259012],
            'å…±å’Œæ–°è·¯ä¸­å±±åŒ—è·¯': [121.458901, 31.252345],
            'å…±å’Œæ–°è·¯ä¸­åæ–°è·¯': [121.460123, 31.245678],
            'ä¸­å…´è·¯å…±å’Œæ–°è·¯': [121.462345, 31.240901],
            'è¥¿è—åŒ—è·¯æ°¸å…´è·¯': [121.470123, 31.238456],
            'è¥¿è—åŒ—è·¯æ›²é˜œè·¯': [121.472345, 31.236789],
            'è¥¿è—ä¸­è·¯åŒ—äº¬ä¸œè·¯': [121.473709, 31.236719],
            // 95è·¯å…¬äº¤ç«™ç‚¹
            'å…±å’Œæ–°è·¯ä¸­å…´è·¯': [121.461234, 31.241567],
            'æˆéƒ½åŒ—è·¯æ–°é—¸è·¯': [121.465678, 31.234890],
            'æˆéƒ½åŒ—è·¯åŒ—äº¬è¥¿è·¯': [121.466217, 31.233330],
            // 451è·¯å…¬äº¤ç«™ç‚¹
            'è¥¿è—å—è·¯å®æµ·ä¸œè·¯': [121.478790, 31.227825],
            'å¤å…´ä¸œè·¯è€è¥¿é—¨': [121.489012, 31.223456],
            'å´‚å±±è·¯å¼ æ¨è·¯': [121.510234, 31.235678],
            'å´‚å±±è·¯æ½åŠè·¯': [121.515678, 31.230901],
            'æµ¦ç”µè·¯å´‚å±±è·¯': [121.520901, 31.226234],
            'ä¸œæ–¹è·¯å³¨å±±è·¯': [121.530123, 31.221567],
            'ä¸œæ–¹è·¯è“æ‘è·¯': [121.535456, 31.217890],
            'æµ¦å»ºè·¯æ¨é«˜å—è·¯': [121.550789, 31.208123],
            'æµ¦å»ºè·¯é”¦ç»£è·¯': [121.560012, 31.203456],
            // 989è·¯å…¬äº¤ç«™ç‚¹
            'æ¨±èŠ±è·¯æµ¦å»ºè·¯': [121.562345, 31.205678],
            'æ¢…èŠ±è·¯æµ·æ¡è·¯': [121.568901, 31.208012],
            'ç™½æ¨è·¯æ¨±èŠ±è·¯': [121.573234, 31.210345],
            'é¾™é˜³è·¯åœ°é“ç«™': [121.567890, 31.207654],
            'é¾™é˜³è·¯èŠ³ç”¸è·¯': [121.580123, 31.212678],
            'é¾™ä¸œå¤§é“ç§‘è‹‘è·¯': [121.595456, 31.216901],
            'é¾™ä¸œå¤§é“é‡‘ç§‘è·¯': [121.605789, 31.219234],
            'é¾™ä¸œå¤§é“å¼ æ±Ÿè·¯': [121.615012, 31.221567],
            'é¾™ä¸œå¤§é“å¹¿å…°è·¯': [121.622345, 31.222890],
            'é¾™ä¸œå¤§é“ç”³æ±Ÿè·¯': [121.628678, 31.223123],
            'é¾™ä¸œå¤§é“å¼ ä¸œè·¯': [121.632988, 31.223932],
            // 1058è·¯å…¬äº¤ç«™ç‚¹
            'ç¥–å†²ä¹‹è·¯å¹¿å…°è·¯': [121.620773, 31.211189],
            'å¹¿å…°è·¯ç¥–å†²ä¹‹è·¯': [121.619234, 31.212456],
            'ä¸¹æ¡‚è·¯å¹¿å…°è·¯': [121.621567, 31.215789],
            'ä¸¹æ¡‚è·¯ç”³æ±Ÿè·¯': [121.625890, 31.218012],
            'ä¸¹æ¡‚è·¯é‡‘ç§‹è·¯': [121.629123, 31.220345],
            'å¼ ä¸œè·¯é¾™ä¸œå¤§é“': [121.632370, 31.221949]
        };

        // è·¯çº¿æ•°æ®
        const routesData = {
            taxi: [{
                name: 'ä¸­ç¯è·¯çº¿',
                duration: 32,
                distance: 26,
                cost: '60-80',
                type: 'driving',
                pathCoords: [
                    [121.451111, 31.277829],
                    [121.451111, 31.278829],
                    [121.452111, 31.279829],
                    [121.451111, 31.277829],
                    [121.451111, 31.284829],
                    [121.456111, 31.290829],
                    [121.470111, 31.295829],
                    [121.520111, 31.295829],
                    [121.570111, 31.280829],
                    [121.590111, 31.265829],
                    [121.600111, 31.250829],
                    [121.610111, 31.235829],
                    [121.625111, 31.225829],
                    [121.628845, 31.221087]
                ],
                steps: [
                    { type: 'driving', instruction: 'æ²¿å…±å’Œæ–°è·¯å‘åŒ—è¡Œé©¶', duration: 2 },
                    { type: 'driving', instruction: 'è¿›å…¥å—åŒ—é«˜æ¶è·¯', duration: 2 },
                    { type: 'driving', instruction: 'æ²¿ä¸­ç¯è·¯å‘ä¸œè¡Œé©¶', duration: 15 },
                    { type: 'driving', instruction: 'ç»å†›å·¥è·¯éš§é“è¿‡æ±Ÿ', duration: 5 },
                    { type: 'driving', instruction: 'æ²¿ä¸­ç¯è·¯ç»§ç»­å‘ä¸œå—', duration: 5 },
                    { type: 'driving', instruction: 'ç»äº‘é¡ºè·¯ã€ç”³æ±Ÿè·¯åˆ°è¾¾ä¸¹æ¡‚è·¯', duration: 3 }
                ]
            }],
            metro: [{
                name: '1å·çº¿ â†’ 2å·çº¿ï¼ˆçº¯åœ°é“ï¼‰',
                duration: 79,
                walkDistance: 2.4,
                cost: 6,
                type: 'transit',
                segments: [
                    { 
                        type: 'walking', 
                        instruction: 'æ­¥è¡Œè‡³ä¸Šæµ·é©¬æˆåŸç«™ï¼ˆ3å·å£ï¼‰',
                        duration: 6,
                        distance: 424,
                        coords: [[121.451111, 31.277829], [121.452026, 31.279892]]
                    },
                    { 
                        type: 'metro',
                        line: 'åœ°é“1å·çº¿',
                        from: 'ä¸Šæµ·é©¬æˆåŸ',
                        to: 'äººæ°‘å¹¿åœº',
                        duration: 15,
                        cost: 3,
                        stops: ['å»¶é•¿è·¯', 'ä¸­å±±åŒ—è·¯', 'ä¸Šæµ·ç«è½¦ç«™', 'æ±‰ä¸­è·¯', 'æ–°é—¸è·¯'],
                        color: '#e4002b'
                    },
                    { 
                        type: 'walking', 
                        instruction: 'ç«™å†…æ¢ä¹˜',
                        duration: 4,
                        distance: 274,
                        coords: [[121.472656, 31.233160], [121.472656, 31.233160]]
                    },
                    { 
                        type: 'metro',
                        line: 'åœ°é“2å·çº¿',
                        from: 'äººæ°‘å¹¿åœº',
                        to: 'å¹¿å…°è·¯',
                        duration: 31,
                        cost: 3,
                        stops: ['å—äº¬ä¸œè·¯', 'é™†å®¶å˜´', 'æµ¦ä¸œå—è·¯(åŸä¸œæ˜Œè·¯)', 'ä¸–çºªå¤§é“', 'ä¸Šæµ·ç§‘æŠ€é¦†', 'ä¸–çºªå…¬å›­', 'é¾™é˜³è·¯', 'å¼ æ±Ÿé«˜ç§‘', 'é‡‘ç§‘è·¯'],
                        color: '#97d700'
                    },
                    { 
                        type: 'walking', 
                        instruction: 'ä»å¹¿å…°è·¯ç«™1å·å£å‡ºç«™ï¼Œæ­¥è¡Œè‡³ä¸Šæµ·æ•°æ®äº¤æ˜“æ‰€',
                        duration: 24,
                        distance: 1684,
                        coords: [[121.621071, 31.211046], [121.628845, 31.221087]]
                    }
                ]
            }, {
                name: '1å·çº¿ â†’ 2å·çº¿ + 1058è·¯',
                duration: 81,
                walkDistance: 1.4,
                cost: 8,
                type: 'transit',
                segments: [
                    { 
                        type: 'walking', 
                        instruction: 'æ­¥è¡Œè‡³ä¸Šæµ·é©¬æˆåŸç«™ï¼ˆ3å·å£ï¼‰',
                        duration: 6,
                        distance: 424,
                        coords: [[121.451111, 31.277829], [121.452026, 31.279892]]
                    },
                    { 
                        type: 'metro',
                        line: 'åœ°é“1å·çº¿',
                        from: 'ä¸Šæµ·é©¬æˆåŸ',
                        to: 'äººæ°‘å¹¿åœº',
                        duration: 15,
                        cost: 3,
                        stops: ['å»¶é•¿è·¯', 'ä¸­å±±åŒ—è·¯', 'ä¸Šæµ·ç«è½¦ç«™', 'æ±‰ä¸­è·¯', 'æ–°é—¸è·¯'],
                        color: '#e4002b'
                    },
                    { 
                        type: 'walking', 
                        instruction: 'ç«™å†…æ¢ä¹˜',
                        duration: 4,
                        distance: 274,
                        coords: [[121.472656, 31.233160], [121.472656, 31.233160]]
                    },
                    { 
                        type: 'metro',
                        line: 'åœ°é“2å·çº¿',
                        from: 'äººæ°‘å¹¿åœº',
                        to: 'å¹¿å…°è·¯',
                        duration: 31,
                        cost: 3,
                        stops: ['å—äº¬ä¸œè·¯', 'é™†å®¶å˜´', 'æµ¦ä¸œå—è·¯(åŸä¸œæ˜Œè·¯)', 'ä¸–çºªå¤§é“', 'ä¸Šæµ·ç§‘æŠ€é¦†', 'ä¸–çºªå…¬å›­', 'é¾™é˜³è·¯', 'å¼ æ±Ÿé«˜ç§‘', 'é‡‘ç§‘è·¯'],
                        color: '#97d700'
                    },
                    { 
                        type: 'walking', 
                        instruction: 'æ­¥è¡Œè‡³ç¥–å†²ä¹‹è·¯å¹¿å…°è·¯ç«™',
                        duration: 3,
                        distance: 225,
                        coords: [[121.621071, 31.211046], [121.620773, 31.211189]]
                    },
                    { 
                        type: 'bus',
                        line: '1058è·¯',
                        from: 'ç¥–å†²ä¹‹è·¯å¹¿å…°è·¯',
                        to: 'å¼ ä¸œè·¯é¾™ä¸œå¤§é“',
                        duration: 16,
                        cost: 2,
                        stops: ['å¹¿å…°è·¯ç¥–å†²ä¹‹è·¯', 'ä¸¹æ¡‚è·¯å¹¿å…°è·¯', 'ä¸¹æ¡‚è·¯ç”³æ±Ÿè·¯', 'ä¸¹æ¡‚è·¯é‡‘ç§‹è·¯'],
                        color: '#10b981'
                    },
                    { 
                        type: 'walking', 
                        instruction: 'æ­¥è¡Œè‡³ä¸Šæµ·æ•°æ®äº¤æ˜“æ‰€',
                        duration: 7,
                        distance: 481,
                        coords: [[121.632370, 31.221949], [121.628845, 31.221087]]
                    }
                ]
            }],
            bus: [{
                name: '46è·¯ â†’ 2å·çº¿ + 1058è·¯',
                duration: 94,
                walkDistance: 1.4,
                cost: 10,
                type: 'transit',
                segments: [
                    { 
                        type: 'walking', 
                        instruction: 'æ­¥è¡Œè‡³å…±å’Œæ–°è·¯å¤§å®è·¯ç«™',
                        duration: 3,
                        distance: 224,
                        coords: [[121.451111, 31.277829], [121.452492, 31.276728]]
                    },
                    { 
                        type: 'bus',
                        line: '46è·¯',
                        from: 'å…±å’Œæ–°è·¯å¤§å®è·¯',
                        to: 'è¥¿è—ä¸­è·¯åŒ—äº¬ä¸œè·¯',
                        duration: 27,
                        cost: 2,
                        stops: ['å…±å’Œæ–°è·¯å»¶é•¿ä¸­è·¯', 'é—¸åŒ—å…¬å›­', 'å…±å’Œæ–°è·¯ä¸­å±±åŒ—è·¯', 'å…±å’Œæ–°è·¯ä¸­åæ–°è·¯', 'ä¸­å…´è·¯å…±å’Œæ–°è·¯', 'è¥¿è—åŒ—è·¯æ°¸å…´è·¯', 'è¥¿è—åŒ—è·¯æ›²é˜œè·¯'],
                        color: '#10b981'
                    },
                    { 
                        type: 'walking', 
                        instruction: 'æ­¥è¡Œè‡³äººæ°‘å¹¿åœºç«™ï¼ˆ7å·å£ï¼‰',
                        duration: 7,
                        distance: 515,
                        coords: [[121.473709, 31.236719], [121.472656, 31.233160]]
                    },
                    { 
                        type: 'metro',
                        line: 'åœ°é“2å·çº¿',
                        from: 'äººæ°‘å¹¿åœº',
                        to: 'å¹¿å…°è·¯',
                        duration: 31,
                        cost: 6,
                        stops: ['å—äº¬ä¸œè·¯', 'é™†å®¶å˜´', 'æµ¦ä¸œå—è·¯(åŸä¸œæ˜Œè·¯)', 'ä¸–çºªå¤§é“', 'ä¸Šæµ·ç§‘æŠ€é¦†', 'ä¸–çºªå…¬å›­', 'é¾™é˜³è·¯', 'å¼ æ±Ÿé«˜ç§‘', 'é‡‘ç§‘è·¯'],
                        color: '#97d700'
                    },
                    { 
                        type: 'walking', 
                        instruction: 'æ­¥è¡Œè‡³ç¥–å†²ä¹‹è·¯å¹¿å…°è·¯ç«™',
                        duration: 3,
                        distance: 225,
                        coords: [[121.621071, 31.211046], [121.620773, 31.211189]]
                    },
                    { 
                        type: 'bus',
                        line: '1058è·¯',
                        from: 'ç¥–å†²ä¹‹è·¯å¹¿å…°è·¯',
                        to: 'å¼ ä¸œè·¯é¾™ä¸œå¤§é“',
                        duration: 16,
                        cost: 2,
                        stops: ['å¹¿å…°è·¯ç¥–å†²ä¹‹è·¯', 'ä¸¹æ¡‚è·¯å¹¿å…°è·¯', 'ä¸¹æ¡‚è·¯ç”³æ±Ÿè·¯', 'ä¸¹æ¡‚è·¯é‡‘ç§‹è·¯'],
                        color: '#10b981'
                    },
                    { 
                        type: 'walking', 
                        instruction: 'æ­¥è¡Œè‡³ä¸Šæµ·æ•°æ®äº¤æ˜“æ‰€',
                        duration: 7,
                        distance: 481,
                        coords: [[121.632370, 31.221949], [121.628845, 31.221087]]
                    }
                ]
            }, {
                name: '46è·¯ â†’ 451è·¯ â†’ 989è·¯',
                duration: 124,
                walkDistance: 1.4,
                cost: 6,
                type: 'transit',
                segments: [
                    { 
                        type: 'walking', 
                        instruction: 'æ­¥è¡Œè‡³å…±å’Œæ–°è·¯å¤§å®è·¯ç«™',
                        duration: 3,
                        distance: 224,
                        coords: [[121.451111, 31.277829], [121.452492, 31.276728]]
                    },
                    { 
                        type: 'bus',
                        line: '46è·¯',
                        from: 'å…±å’Œæ–°è·¯å¤§å®è·¯',
                        to: 'äººæ°‘å¹¿åœº',
                        duration: 32,
                        cost: 2,
                        stops: ['å…±å’Œæ–°è·¯å»¶é•¿ä¸­è·¯', 'é—¸åŒ—å…¬å›­', 'å…±å’Œæ–°è·¯ä¸­å±±åŒ—è·¯', 'å…±å’Œæ–°è·¯ä¸­åæ–°è·¯', 'ä¸­å…´è·¯å…±å’Œæ–°è·¯', 'è¥¿è—åŒ—è·¯æ°¸å…´è·¯', 'è¥¿è—åŒ—è·¯æ›²é˜œè·¯', 'è¥¿è—ä¸­è·¯åŒ—äº¬ä¸œè·¯'],
                        color: '#10b981'
                    },
                    { 
                        type: 'walking', 
                        instruction: 'æ­¥è¡Œè‡³è¥¿è—å—è·¯å®æµ·ä¸œè·¯ç«™',
                        duration: 5,
                        distance: 364,
                        coords: [[121.476852, 31.228376], [121.478790, 31.227825]]
                    },
                    { 
                        type: 'bus',
                        line: '451è·¯',
                        from: 'è¥¿è—å—è·¯å®æµ·ä¸œè·¯',
                        to: 'æµ¦å»ºè·¯é”¦ç»£è·¯',
                        duration: 36,
                        cost: 2,
                        stops: ['å¤å…´ä¸œè·¯è€è¥¿é—¨', 'å´‚å±±è·¯å¼ æ¨è·¯', 'å´‚å±±è·¯æ½åŠè·¯', 'æµ¦ç”µè·¯å´‚å±±è·¯', 'ä¸œæ–¹è·¯å³¨å±±è·¯', 'ä¸œæ–¹è·¯è“æ‘è·¯', 'æµ¦å»ºè·¯æ¨é«˜å—è·¯'],
                        color: '#f59e0b'
                    },
                    { 
                        type: 'bus',
                        line: '989è·¯',
                        from: 'æµ¦å»ºè·¯é”¦ç»£è·¯',
                        to: 'é¾™ä¸œå¤§é“å¼ ä¸œè·¯',
                        duration: 36,
                        cost: 2,
                        stops: ['æ¨±èŠ±è·¯æµ¦å»ºè·¯', 'æ¢…èŠ±è·¯æµ·æ¡è·¯', 'ç™½æ¨è·¯æ¨±èŠ±è·¯', 'é¾™é˜³è·¯åœ°é“ç«™', 'é¾™é˜³è·¯èŠ³ç”¸è·¯', 'é¾™ä¸œå¤§é“ç§‘è‹‘è·¯', 'é¾™ä¸œå¤§é“é‡‘ç§‘è·¯', 'é¾™ä¸œå¤§é“å¼ æ±Ÿè·¯', 'é¾™ä¸œå¤§é“å¹¿å…°è·¯', 'é¾™ä¸œå¤§é“ç”³æ±Ÿè·¯'],
                        color: '#8b5cf6'
                    },
                    { 
                        type: 'walking', 
                        instruction: 'æ­¥è¡Œè‡³ä¸Šæµ·æ•°æ®äº¤æ˜“æ‰€',
                        duration: 11,
                        distance: 779,
                        coords: [[121.632988, 31.223932], [121.628845, 31.221087]]
                    }
                ]
            }, {
                name: '95è·¯ â†’ 2å·çº¿',
                duration: 97,
                walkDistance: 2.8,
                cost: 8,
                type: 'transit',
                segments: [
                    { 
                        type: 'walking', 
                        instruction: 'æ­¥è¡Œè‡³å…±å’Œæ–°è·¯å¤§å®è·¯ç«™',
                        duration: 3,
                        distance: 224,
                        coords: [[121.451111, 31.277829], [121.452492, 31.276728]]
                    },
                    { 
                        type: 'bus',
                        line: '95è·¯',
                        from: 'å…±å’Œæ–°è·¯å¤§å®è·¯',
                        to: 'æˆéƒ½åŒ—è·¯åŒ—äº¬è¥¿è·¯',
                        duration: 27,
                        cost: 2,
                        stops: ['å…±å’Œæ–°è·¯å»¶é•¿ä¸­è·¯', 'é—¸åŒ—å…¬å›­', 'å…±å’Œæ–°è·¯ä¸­å±±åŒ—è·¯', 'å…±å’Œæ–°è·¯ä¸­åæ–°è·¯', 'å…±å’Œæ–°è·¯ä¸­å…´è·¯', 'æˆéƒ½åŒ—è·¯æ–°é—¸è·¯'],
                        color: '#10b981'
                    },
                    { 
                        type: 'walking', 
                        instruction: 'æ­¥è¡Œè‡³äººæ°‘å¹¿åœºç«™ï¼ˆ11å·å£ï¼‰',
                        duration: 12,
                        distance: 876,
                        coords: [[121.466217, 31.233330], [121.472649, 31.233156]]
                    },
                    { 
                        type: 'metro',
                        line: 'åœ°é“2å·çº¿',
                        from: 'äººæ°‘å¹¿åœº',
                        to: 'å¹¿å…°è·¯',
                        duration: 31,
                        cost: 6,
                        stops: ['å—äº¬ä¸œè·¯', 'é™†å®¶å˜´', 'æµ¦ä¸œå—è·¯(åŸä¸œæ˜Œè·¯)', 'ä¸–çºªå¤§é“', 'ä¸Šæµ·ç§‘æŠ€é¦†', 'ä¸–çºªå…¬å›­', 'é¾™é˜³è·¯', 'å¼ æ±Ÿé«˜ç§‘', 'é‡‘ç§‘è·¯'],
                        color: '#97d700'
                    },
                    { 
                        type: 'walking', 
                        instruction: 'ä»å¹¿å…°è·¯ç«™1å·å£å‡ºç«™ï¼Œæ­¥è¡Œè‡³ä¸Šæµ·æ•°æ®äº¤æ˜“æ‰€',
                        duration: 24,
                        distance: 1684,
                        coords: [[121.621071, 31.211046], [121.628845, 31.221087]]
                    }
                ]
            }]
        };

        // æ‰€æœ‰ç«™ç‚¹ä¿¡æ¯ï¼ˆç”¨äºæ—¶é—´æ£€æŸ¥ï¼‰
        const allStations = {
            '1å·çº¿': {
                stations: ['ä¸Šæµ·é©¬æˆåŸ', 'å»¶é•¿è·¯', 'ä¸­å±±åŒ—è·¯', 'ä¸Šæµ·ç«è½¦ç«™', 'æ±‰ä¸­è·¯', 'æ–°é—¸è·¯', 'äººæ°‘å¹¿åœº'],
                avgTimePerStop: 2.5,
                stationIndex: {
                    'ä¸Šæµ·é©¬æˆåŸ': 0, 'å»¶é•¿è·¯': 1, 'ä¸­å±±åŒ—è·¯': 2, 'ä¸Šæµ·ç«è½¦ç«™': 3, 
                    'æ±‰ä¸­è·¯': 4, 'æ–°é—¸è·¯': 5, 'äººæ°‘å¹¿åœº': 6
                }
            },
            '2å·çº¿': {
                stations: ['äººæ°‘å¹¿åœº', 'å—äº¬ä¸œè·¯', 'é™†å®¶å˜´', 'æµ¦ä¸œå—è·¯(åŸä¸œæ˜Œè·¯)', 'ä¸–çºªå¤§é“', 
                          'ä¸Šæµ·ç§‘æŠ€é¦†', 'ä¸–çºªå…¬å›­', 'é¾™é˜³è·¯', 'å¼ æ±Ÿé«˜ç§‘', 'é‡‘ç§‘è·¯', 'å¹¿å…°è·¯'],
                avgTimePerStop: 2.8,
                stationIndex: {
                    'äººæ°‘å¹¿åœº': 0, 'å—äº¬ä¸œè·¯': 1, 'é™†å®¶å˜´': 2, 'æµ¦ä¸œå—è·¯(åŸä¸œæ˜Œè·¯)': 3,
                    'ä¸–çºªå¤§é“': 4, 'ä¸Šæµ·ç§‘æŠ€é¦†': 5, 'ä¸–çºªå…¬å›­': 6, 'é¾™é˜³è·¯': 7,
                    'å¼ æ±Ÿé«˜ç§‘': 8, 'é‡‘ç§‘è·¯': 9, 'å¹¿å…°è·¯': 10
                }
            },
            '46è·¯': {
                stations: ['å…±å’Œæ–°è·¯å¤§å®è·¯', 'å…±å’Œæ–°è·¯å»¶é•¿ä¸­è·¯', 'é—¸åŒ—å…¬å›­', 'å…±å’Œæ–°è·¯ä¸­å±±åŒ—è·¯', 
                          'å…±å’Œæ–°è·¯ä¸­åæ–°è·¯', 'ä¸­å…´è·¯å…±å’Œæ–°è·¯', 'è¥¿è—åŒ—è·¯æ°¸å…´è·¯', 'è¥¿è—åŒ—è·¯æ›²é˜œè·¯', 
                          'è¥¿è—ä¸­è·¯åŒ—äº¬ä¸œè·¯', 'äººæ°‘å¹¿åœº'],
                avgTimePerStop: 3.2,
                stationIndex: {
                    'å…±å’Œæ–°è·¯å¤§å®è·¯': 0, 'å…±å’Œæ–°è·¯å»¶é•¿ä¸­è·¯': 1, 'é—¸åŒ—å…¬å›­': 2, 
                    'å…±å’Œæ–°è·¯ä¸­å±±åŒ—è·¯': 3, 'å…±å’Œæ–°è·¯ä¸­åæ–°è·¯': 4, 'ä¸­å…´è·¯å…±å’Œæ–°è·¯': 5,
                    'è¥¿è—åŒ—è·¯æ°¸å…´è·¯': 6, 'è¥¿è—åŒ—è·¯æ›²é˜œè·¯': 7, 'è¥¿è—ä¸­è·¯åŒ—äº¬ä¸œè·¯': 8, 'äººæ°‘å¹¿åœº': 9
                }
            },
            '95è·¯': {
                stations: ['å…±å’Œæ–°è·¯å¤§å®è·¯', 'å…±å’Œæ–°è·¯å»¶é•¿ä¸­è·¯', 'é—¸åŒ—å…¬å›­', 'å…±å’Œæ–°è·¯ä¸­å±±åŒ—è·¯', 
                          'å…±å’Œæ–°è·¯ä¸­åæ–°è·¯', 'å…±å’Œæ–°è·¯ä¸­å…´è·¯', 'æˆéƒ½åŒ—è·¯æ–°é—¸è·¯', 'æˆéƒ½åŒ—è·¯åŒ—äº¬è¥¿è·¯'],
                avgTimePerStop: 3.2,
                stationIndex: {
                    'å…±å’Œæ–°è·¯å¤§å®è·¯': 0, 'å…±å’Œæ–°è·¯å»¶é•¿ä¸­è·¯': 1, 'é—¸åŒ—å…¬å›­': 2, 
                    'å…±å’Œæ–°è·¯ä¸­å±±åŒ—è·¯': 3, 'å…±å’Œæ–°è·¯ä¸­åæ–°è·¯': 4, 'å…±å’Œæ–°è·¯ä¸­å…´è·¯': 5,
                    'æˆéƒ½åŒ—è·¯æ–°é—¸è·¯': 6, 'æˆéƒ½åŒ—è·¯åŒ—äº¬è¥¿è·¯': 7
                }
            },
            '451è·¯': {
                stations: ['è¥¿è—å—è·¯å®æµ·ä¸œè·¯', 'å¤å…´ä¸œè·¯è€è¥¿é—¨', 'å´‚å±±è·¯å¼ æ¨è·¯', 'å´‚å±±è·¯æ½åŠè·¯', 
                          'æµ¦ç”µè·¯å´‚å±±è·¯', 'ä¸œæ–¹è·¯å³¨å±±è·¯', 'ä¸œæ–¹è·¯è“æ‘è·¯', 'æµ¦å»ºè·¯æ¨é«˜å—è·¯', 'æµ¦å»ºè·¯é”¦ç»£è·¯'],
                avgTimePerStop: 4,
                stationIndex: {
                    'è¥¿è—å—è·¯å®æµ·ä¸œè·¯': 0, 'å¤å…´ä¸œè·¯è€è¥¿é—¨': 1, 'å´‚å±±è·¯å¼ æ¨è·¯': 2,
                    'å´‚å±±è·¯æ½åŠè·¯': 3, 'æµ¦ç”µè·¯å´‚å±±è·¯': 4, 'ä¸œæ–¹è·¯å³¨å±±è·¯': 5,
                    'ä¸œæ–¹è·¯è“æ‘è·¯': 6, 'æµ¦å»ºè·¯æ¨é«˜å—è·¯': 7, 'æµ¦å»ºè·¯é”¦ç»£è·¯': 8
                }
            },
            '989è·¯': {
                stations: ['æµ¦å»ºè·¯é”¦ç»£è·¯', 'æ¨±èŠ±è·¯æµ¦å»ºè·¯', 'æ¢…èŠ±è·¯æµ·æ¡è·¯', 'ç™½æ¨è·¯æ¨±èŠ±è·¯', 
                          'é¾™é˜³è·¯åœ°é“ç«™', 'é¾™é˜³è·¯èŠ³ç”¸è·¯', 'é¾™ä¸œå¤§é“ç§‘è‹‘è·¯', 'é¾™ä¸œå¤§é“é‡‘ç§‘è·¯', 
                          'é¾™ä¸œå¤§é“å¼ æ±Ÿè·¯', 'é¾™ä¸œå¤§é“å¹¿å…°è·¯', 'é¾™ä¸œå¤§é“ç”³æ±Ÿè·¯', 'é¾™ä¸œå¤§é“å¼ ä¸œè·¯'],
                avgTimePerStop: 3,
                stationIndex: {
                    'æµ¦å»ºè·¯é”¦ç»£è·¯': 0, 'æ¨±èŠ±è·¯æµ¦å»ºè·¯': 1, 'æ¢…èŠ±è·¯æµ·æ¡è·¯': 2, 'ç™½æ¨è·¯æ¨±èŠ±è·¯': 3,
                    'é¾™é˜³è·¯åœ°é“ç«™': 4, 'é¾™é˜³è·¯èŠ³ç”¸è·¯': 5, 'é¾™ä¸œå¤§é“ç§‘è‹‘è·¯': 6, 'é¾™ä¸œå¤§é“é‡‘ç§‘è·¯': 7,
                    'é¾™ä¸œå¤§é“å¼ æ±Ÿè·¯': 8, 'é¾™ä¸œå¤§é“å¹¿å…°è·¯': 9, 'é¾™ä¸œå¤§é“ç”³æ±Ÿè·¯': 10, 'é¾™ä¸œå¤§é“å¼ ä¸œè·¯': 11
                }
            },
            '1058è·¯': {
                stations: ['ç¥–å†²ä¹‹è·¯å¹¿å…°è·¯', 'å¹¿å…°è·¯ç¥–å†²ä¹‹è·¯', 'ä¸¹æ¡‚è·¯å¹¿å…°è·¯', 'ä¸¹æ¡‚è·¯ç”³æ±Ÿè·¯', 
                          'ä¸¹æ¡‚è·¯é‡‘ç§‹è·¯', 'å¼ ä¸œè·¯é¾™ä¸œå¤§é“'],
                avgTimePerStop: 3,
                stationIndex: {
                    'ç¥–å†²ä¹‹è·¯å¹¿å…°è·¯': 0, 'å¹¿å…°è·¯ç¥–å†²ä¹‹è·¯': 1, 'ä¸¹æ¡‚è·¯å¹¿å…°è·¯': 2, 
                    'ä¸¹æ¡‚è·¯ç”³æ±Ÿè·¯': 3, 'ä¸¹æ¡‚è·¯é‡‘ç§‹è·¯': 4, 'å¼ ä¸œè·¯é¾™ä¸œå¤§é“': 5
                }
            }
        };

        // è®¡ç®—ä»å½“å‰ç«™ç‚¹åˆ°ç›®çš„åœ°å‰©ä½™æ—¶é—´çš„å‡½æ•°
        function calculateRemainingTime(lineName, currentStation) {
            const line = allStations[lineName];
            if (!line) return null;
            
            const currentIndex = line.stationIndex[currentStation];
            if (currentIndex === undefined) return null;
            
            const totalStations = Object.keys(line.stationIndex).length;
            const remainingStops = totalStations - currentIndex - 1;
            
            let remainingTime = remainingStops * line.avgTimePerStop;
            
            if (lineName === '1å·çº¿') {
                remainingTime += 4;
                remainingTime += 10 * 2.8;
                remainingTime += 24;
            } else if (lineName === '2å·çº¿') {
                remainingTime += 24;
            } else if (lineName === '46è·¯' || lineName === '95è·¯') {
                remainingTime += 10;
                remainingTime += 10 * 2.8;
                remainingTime += 24;
            } else if (lineName === '451è·¯') {
                remainingTime += 36;
                remainingTime += 11;
            } else if (lineName === '989è·¯') {
                remainingTime += 11;
            } else if (lineName === '1058è·¯') {
                remainingTime += 7;
            }
            
            return Math.ceil(remainingTime);
        }

        let currentTransport = null;
        let currentRoute = null;
        let selectedTime = null;

        // åˆå§‹åŒ–åœ°å›¾
        function initMap() {
            map = new AMap.Map('routeMap', {
                zoom: 12,
                center: [121.54, 31.24],
                mapStyle: 'amap://styles/dark'
            });
        }

        // æ¸…é™¤åœ°å›¾ä¸Šçš„æ‰€æœ‰è¦†ç›–ç‰©
        function clearMap() {
            if (currentPolylines.length > 0) {
                map.remove(currentPolylines);
                currentPolylines = [];
            }
            if (currentMarkers.length > 0) {
                map.remove(currentMarkers);
                currentMarkers = [];
            }
        }

        // æ·»åŠ èµ·ç‚¹ç»ˆç‚¹æ ‡è®°
        function addStartEndMarkers() {
            // èµ·ç‚¹æ ‡è®°
            const startMarker = new AMap.Marker({
                position: originCoord,
                content: '<div style="background:#22c55e;color:white;padding:8px 12px;border-radius:20px;font-size:12px;font-weight:bold;box-shadow:0 2px 10px rgba(34,197,94,0.5);white-space:nowrap;">ğŸ  ä¸Šæµ·é©¬æˆåŸ</div>',
                offset: new AMap.Pixel(-60, -40)
            });
            
            // ç»ˆç‚¹æ ‡è®°
            const endMarker = new AMap.Marker({
                position: destCoord,
                content: '<div style="background:#ef4444;color:white;padding:8px 12px;border-radius:20px;font-size:12px;font-weight:bold;box-shadow:0 2px 10px rgba(239,68,68,0.5);white-space:nowrap;">ğŸ¢ ä¸Šæµ·æ•°æ®äº¤æ˜“æ‰€</div>',
                offset: new AMap.Pixel(-70, -40)
            });
            
            currentMarkers.push(startMarker, endMarker);
            map.add([startMarker, endMarker]);
        }

        // ç»˜åˆ¶é©¾è½¦è·¯çº¿
        function drawDrivingRoute(route) {
            clearMap();
            addStartEndMarkers();
            
            // ä½¿ç”¨é«˜å¾·é©¾è½¦è§„åˆ’API
            const driving = new AMap.Driving({
                map: map,
                policy: AMap.DrivingPolicy.LEAST_TIME,
                hideMarkers: true,
                autoFitView: true
            });
            
            driving.search(originCoord, destCoord, function(status, result) {
                if (status === 'complete') {
                    console.log('é©¾è½¦è·¯çº¿è§„åˆ’æˆåŠŸ');
                } else {
                    // å¤‡ç”¨ï¼šæ‰‹åŠ¨ç»˜åˆ¶è·¯çº¿
                    const polyline = new AMap.Polyline({
                        path: route.pathCoords,
                        strokeColor: '#f97316',
                        strokeWeight: 6,
                        strokeOpacity: 0.9,
                        lineJoin: 'round',
                        lineCap: 'round',
                        showDir: true
                    });
                    currentPolylines.push(polyline);
                    map.add(polyline);
                    map.setFitView();
                }
            });
            
            // æ›´æ–°å›¾ä¾‹
            updateLegend('driving');
        }

        // ç»˜åˆ¶å…¬äº¤/åœ°é“è·¯çº¿
        function drawTransitRoute(route) {
            clearMap();
            addStartEndMarkers();
            
            let allPoints = [];
            
            route.segments.forEach((segment, index) => {
                if (segment.type === 'walking' && segment.coords) {
                    // æ­¥è¡Œè·¯çº¿ - è™šçº¿
                    const walkPath = segment.coords;
                    allPoints = allPoints.concat(walkPath);
                    
                    const walkPolyline = new AMap.Polyline({
                        path: walkPath,
                        strokeColor: '#94a3b8',
                        strokeWeight: 4,
                        strokeStyle: 'dashed',
                        strokeDasharray: [10, 5],
                        strokeOpacity: 0.8
                    });
                    currentPolylines.push(walkPolyline);
                    map.add(walkPolyline);
                    
                } else if (segment.type === 'metro' || segment.type === 'bus') {
                    // è·å–ç«™ç‚¹åæ ‡
                    const fromCoord = stationCoords[segment.from];
                    const toCoord = stationCoords[segment.to];
                    
                    if (fromCoord && toCoord) {
                        // æ„å»ºç»è¿‡ç«™ç‚¹çš„è·¯å¾„
                        let pathCoords = [fromCoord];
                        
                        segment.stops.forEach(stop => {
                            if (stationCoords[stop]) {
                                pathCoords.push(stationCoords[stop]);
                            }
                        });
                        
                        pathCoords.push(toCoord);
                        allPoints = allPoints.concat(pathCoords);
                        
                        // ç»˜åˆ¶çº¿è·¯
                        const lineColor = segment.color || (segment.type === 'metro' ? '#0ea5e9' : '#10b981');
                        const transitPolyline = new AMap.Polyline({
                            path: pathCoords,
                            strokeColor: lineColor,
                            strokeWeight: 6,
                            strokeOpacity: 0.9,
                            lineJoin: 'round',
                            lineCap: 'round',
                            showDir: true
                        });
                        currentPolylines.push(transitPolyline);
                        map.add(transitPolyline);
                        
                        // æ·»åŠ ç«™ç‚¹æ ‡è®°
                        pathCoords.forEach((coord, i) => {
                            let stationName = '';
                            if (i === 0) stationName = segment.from;
                            else if (i === pathCoords.length - 1) stationName = segment.to;
                            else stationName = segment.stops[i - 1];
                            
                            const isTerminal = i === 0 || i === pathCoords.length - 1;
                            
                            const stationMarker = new AMap.Marker({
                                position: coord,
                                content: `<div style="
                                    background: ${isTerminal ? lineColor : 'white'};
                                    width: ${isTerminal ? '12px' : '8px'};
                                    height: ${isTerminal ? '12px' : '8px'};
                                    border-radius: 50%;
                                    border: 2px solid ${lineColor};
                                    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                                "></div>`,
                                offset: new AMap.Pixel(isTerminal ? -6 : -4, isTerminal ? -6 : -4),
                                title: stationName
                            });
                            currentMarkers.push(stationMarker);
                            map.add(stationMarker);
                        });
                    }
                }
            });
            
            // è‡ªé€‚åº”è§†é‡
            if (allPoints.length > 0) {
                map.setFitView(null, false, [50, 50, 50, 50]);
            }
            
            // æ›´æ–°å›¾ä¾‹
            updateLegend('transit');
        }

        // æ›´æ–°å›¾ä¾‹æ˜¾ç¤º
        function updateLegend(type) {
            document.getElementById('legend-driving').style.display = type === 'driving' ? 'flex' : 'none';
            document.getElementById('legend-metro').style.display = type === 'transit' ? 'flex' : 'none';
            document.getElementById('legend-bus').style.display = type === 'transit' ? 'flex' : 'none';
            document.getElementById('legend-walking').style.display = type === 'transit' ? 'flex' : 'none';
        }

        function selectTransport(type) {
            currentTransport = type;
            
            document.querySelectorAll('.transport-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.transport-btn.${type}`).classList.add('active');
            
            document.querySelectorAll('.routes-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            document.getElementById(`${type}-routes`).classList.add('active');
            document.getElementById('route-details').classList.remove('active');
        }

        function selectRoute(type, index) {
            currentRoute = { type, index };
            
            document.querySelectorAll('.route-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.route-btn').classList.add('active');
            
            const route = routesData[type][index];
            showRouteDetails(route, type);
        }

        function showRouteDetails(route, type) {
            const detailsPanel = document.getElementById('route-details');
            const title = document.getElementById('details-title');
            const summary = document.getElementById('details-summary');
            const timeline = document.getElementById('route-timeline');
            
            title.textContent = route.name;
            
            // ç”Ÿæˆæ‘˜è¦
            let summaryHTML = `
                <div class="summary-item">
                    <div class="value">${route.duration}</div>
                    <div class="label">åˆ†é’Ÿ</div>
                </div>
            `;
            
            if (route.distance) {
                summaryHTML += `
                    <div class="summary-item">
                        <div class="value">${route.distance}</div>
                        <div class="label">å…¬é‡Œ</div>
                    </div>
                `;
            }
            
            if (route.walkDistance) {
                summaryHTML += `
                    <div class="summary-item">
                        <div class="value">${route.walkDistance}</div>
                        <div class="label">æ­¥è¡Œå…¬é‡Œ</div>
                    </div>
                `;
            }
            
            summaryHTML += `
                <div class="summary-item cost">
                    <div class="value">Â¥${route.cost}</div>
                    <div class="label">é¢„ä¼°è´¹ç”¨</div>
                </div>
            `;
            
            summary.innerHTML = summaryHTML;
            
            // ç”Ÿæˆæ—¶é—´çº¿
            let timelineHTML = '';
            
            if (type === 'taxi') {
                route.steps.forEach(step => {
                    timelineHTML += `
                        <div class="timeline-item driving">
                            <div class="timeline-header">
                                <div class="timeline-type">
                                    <span class="icon">ğŸš•</span>
                                    <span>é©¾è½¦</span>
                                </div>
                                <div class="timeline-duration">çº¦${step.duration}åˆ†é’Ÿ</div>
                            </div>
                            <div class="timeline-content">${step.instruction}</div>
                        </div>
                    `;
                });
            } else {
                route.segments.forEach(segment => {
                    if (segment.type === 'walking') {
                        timelineHTML += `
                            <div class="timeline-item walking">
                                <div class="timeline-header">
                                    <div class="timeline-type">
                                        <span class="icon">ğŸš¶</span>
                                        <span>æ­¥è¡Œ</span>
                                    </div>
                                    <div class="timeline-duration">çº¦${segment.duration}åˆ†é’Ÿ Â· ${segment.distance}ç±³</div>
                                </div>
                                <div class="timeline-content">${segment.instruction}</div>
                            </div>
                        `;
                    } else if (segment.type === 'metro') {
                        let stopsHTML = segment.stops.map(stop => 
                            `<span class="stop-tag">${stop}</span>`
                        ).join('');
                        
                        timelineHTML += `
                            <div class="timeline-item transit">
                                <div class="timeline-header">
                                    <div class="timeline-type">
                                        <span class="icon">ğŸš‡</span>
                                        <span>${segment.line}</span>
                                    </div>
                                    <div class="timeline-duration">çº¦${segment.duration}åˆ†é’Ÿ Â· Â¥${segment.cost}</div>
                                </div>
                                <div class="timeline-content">
                                    <strong>${segment.from}</strong> â†’ <strong>${segment.to}</strong>
                                </div>
                                <div class="timeline-stops">
                                    <span class="stop-tag highlight">${segment.from}</span>
                                    ${stopsHTML}
                                    <span class="stop-tag highlight">${segment.to}</span>
                                </div>
                            </div>
                        `;
                    } else if (segment.type === 'bus') {
                        let stopsHTML = segment.stops.map(stop => 
                            `<span class="stop-tag">${stop}</span>`
                        ).join('');
                        
                        timelineHTML += `
                            <div class="timeline-item bus-transit">
                                <div class="timeline-header">
                                    <div class="timeline-type">
                                        <span class="icon">ğŸšŒ</span>
                                        <span>${segment.line}</span>
                                    </div>
                                    <div class="timeline-duration">çº¦${segment.duration}åˆ†é’Ÿ Â· Â¥${segment.cost}</div>
                                </div>
                                <div class="timeline-content">
                                    <strong>${segment.from}</strong> â†’ <strong>${segment.to}</strong>
                                </div>
                                <div class="timeline-stops">
                                    <span class="stop-tag highlight">${segment.from}</span>
                                    ${stopsHTML}
                                    <span class="stop-tag highlight">${segment.to}</span>
                                </div>
                            </div>
                        `;
                    }
                });
            }
            
            timeline.innerHTML = timelineHTML;
            detailsPanel.classList.add('active');
            
            // åˆå§‹åŒ–åœ°å›¾å¹¶ç»˜åˆ¶è·¯çº¿
            if (!map) {
                initMap();
                map.on('complete', function() {
                    if (type === 'taxi') {
                        drawDrivingRoute(route);
                    } else {
                        drawTransitRoute(route);
                    }
                });
            } else {
                if (type === 'taxi') {
                    drawDrivingRoute(route);
                } else {
                    drawTransitRoute(route);
                }
            }
        }

        function onTimeSelect() {
            const timeInput = document.getElementById('currentTime');
            selectedTime = timeInput.value;
            
            if (selectedTime) {
                const stationGroup = document.getElementById('stationSelectGroup');
                stationGroup.classList.add('active');
                generateStationButtons();
            }
        }

        function generateStationButtons() {
            const stationGrid = document.getElementById('stationGrid');
            let stationsHTML = '';
            
            Object.keys(allStations).forEach(lineName => {
                const line = allStations[lineName];
                line.stations.forEach(station => {
                    stationsHTML += `
                        <button class="station-btn" onclick="selectStation('${lineName}', '${station}')">
                            ${station}
                            <span class="line-tag">${lineName}</span>
                        </button>
                    `;
                });
            });
            
            stationGrid.innerHTML = stationsHTML;
        }

        function selectStation(lineName, stationName) {
            document.querySelectorAll('.station-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.closest('.station-btn').classList.add('selected');
            calculateResult(lineName, stationName);
        }

        function calculateResult(lineName, stationName) {
            const resultDisplay = document.getElementById('resultDisplay');
            const resultIcon = document.getElementById('resultIcon');
            const resultMessage = document.getElementById('resultMessage');
            const resultDetail = document.getElementById('resultDetail');
            
            const [hours, minutes] = selectedTime.split(':').map(Number);
            const selectedMinutes = hours * 60 + minutes;
            const deadlineMinutes = 9 * 60;
            
            if (selectedMinutes >= deadlineMinutes) {
                resultDisplay.className = 'result-display active danger';
                resultIcon.textContent = 'ğŸ˜±';
                resultMessage.textContent = 'ä½ å·²ç»è¿Ÿåˆ°äº†ï¼';
                
                const remainingTime = calculateRemainingTime(lineName, stationName);
                if (remainingTime) {
                    const arrivalMinutes = selectedMinutes + remainingTime;
                    const arrivalHours = Math.floor(arrivalMinutes / 60);
                    const arrivalMins = arrivalMinutes % 60;
                    resultDetail.textContent = `ç»§ç»­æŒ‰åŸè·¯çº¿å‰è¿›ï¼Œé¢„è®¡ ${arrivalHours}:${arrivalMins.toString().padStart(2, '0')} åˆ°è¾¾ç›®çš„åœ°`;
                } else {
                    resultDetail.textContent = 'æ— æ³•è®¡ç®—åˆ°è¾¾æ—¶é—´';
                }
                return;
            }
            
            const timeUntilDeadline = deadlineMinutes - selectedMinutes;
            const remainingTime = calculateRemainingTime(lineName, stationName);
            
            if (!remainingTime) {
                resultDisplay.className = 'result-display active warning';
                resultIcon.textContent = 'â“';
                resultMessage.textContent = 'æ— æ³•è®¡ç®—';
                resultDetail.textContent = 'è¯·é€‰æ‹©æ­£ç¡®çš„çº¿è·¯ç«™ç‚¹';
                return;
            }
            
            if (remainingTime <= timeUntilDeadline - 5) {
                resultDisplay.className = 'result-display active safe';
                resultIcon.textContent = 'ğŸ˜Š';
                resultMessage.textContent = 'ä½ ä¸ä¼šè¿Ÿåˆ°ï¼Œç»§ç»­æŒ‰åŸè·¯çº¿å‰è¿›ï¼';
                resultDetail.textContent = `è·ç¦»9ç‚¹è¿˜æœ‰ ${timeUntilDeadline} åˆ†é’Ÿï¼Œé¢„è®¡è¿˜éœ€ ${remainingTime} åˆ†é’Ÿåˆ°è¾¾`;
            } else {
                resultDisplay.className = 'result-display active warning';
                resultIcon.textContent = 'ğŸ˜°';
                resultMessage.textContent = 'ä½ è¦è¿Ÿåˆ°äº†ï¼Œèµ¶å¿«å°±è¿‘æ‰“è½¦ï¼';
                resultDetail.textContent = `è·ç¦»9ç‚¹è¿˜æœ‰ ${timeUntilDeadline} åˆ†é’Ÿï¼Œä½†æŒ‰åŸè·¯çº¿éœ€è¦çº¦ ${remainingTime} åˆ†é’Ÿ`;
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            document.getElementById('currentTime').value = `${hours}:${minutes}`;
        });
    </script>
</body>
</html>
